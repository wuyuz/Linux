## Linux 命令基础四



![1564651430441](C:\Users\RootUser\Desktop\知识点复习\Django\gif\1564651430441.png)



#### 打开文件

##### vi

##### vim  (vi的增强版)

```shell
+# 打开文件后，让光标处于第#行的行首
[root@MyHost ~]# vim +2 1.txt      # 光标自动停留在第2行

+/PATTERN 打开文件后，光标处于第一个被parrent匹配到的行首
[root@MyHost ~]# vim +/a 1.txt    

-b file 二进制方式打开文件  #同样只读

-d file1 file2 对比多个文件
[root@MyHost ~]# vim -d 11.txt 1.txt   #好像也不可以修改

-m file 只读打开文件
[root@MyHost ~]# vim -m 1.txt     #当编辑后，保存会报错
E142: File not written: Writing is disabled by 'write' option  

-e 直接进入ex 模式 #ex是Unix下的一个文本编辑器，vi就是ex的"visual mode"。
  # 启动后，按 大写的 Q，可进入 EX 模式，输入 visual 退出 Ex模式～
```

- ##### 小提示：

  ```
  1、如果该文件存在，文件被打开并显示内容
  2、如果文件不存在，当编辑后第一次存盘时创建它
  ```

  

#### vim模式

按键行为是依赖于vim的模式

- 命令模式：打开后默认，移动光标，剪切/粘贴文本

- 插入模式或者编辑模式：编辑文件

- 扩展命令模式（末行模式）：保存、退出等等

- 可视化模式：

  ![1564653593701](C:\Users\RootUser\Desktop\知识点复习\Django\gif\1564653593701.png)

#### 模式切换

- ##### 命令模式 —> 插入模式

  - i 在光标所在处输入
  - I 在当前光标所在行的行首输入，默认跳到插入模式的行首
  - a 在光标所在处后面输入
  - A 在光标所在行的行尾输入
  - o 在当前光标所在行的下方打开一个新行
  - O 在当前光标所在行的上方打开一个新行

- ##### 插入模式 —> 命令模式

  - esc

- ##### 命令模式—> 末行模式

  - ：   （shift+:)

- ##### 扩展命令模式—>命令模式

  - esc  enter  （先按esc，再按enter)
  - esc  esc  (两次esc)



#### 关闭文件

- 扩展命令模式
  - :q 退出
  - :q! 强制退出
  - :wq 保存退出
  - :x 保存退出
- 命令模式
  - ZZ 保存退出   （再命令模式下两个大Z，保存退出）
  - ZQ 不保存退出



#### 扩展命令模式

- 按“：”进入ex模式

- 创建一个命令提示符：处于底部的屏幕左侧

- 命令：

  - w 写（存）磁盘文件

  - wq 保存并退出

  - x 写入并退出

  - q 退出

  - q! 不存盘退出

  - r filename 读文件内容到当前文件中

    ```shell
    :r 1.txt       # 在光标所在行后插入1.txt文件内容
    ```

  - w filename 将当前文件内容写入另外一个文件，另存为

    ```shell
    :w 2.txt       # 将此文件写入到2.txt中，如果没有就新建
    "2.txt" [New] 27L, 177C written   
    ```

  - !command 执行命令（任何命令）

    ```shell
    :! whoami       # 用于查看命令，不用退出vim，查看完后回车，又回到vim中
    ```

  - r!command 读入命令的输出

    ```shell
    :r! whoami       # 将命令的结果输出到文件光标，直接将命令的执行结果写入到文件中，光标所在行的下一行
    ```



#### 光标的移动

- ##### 字符间移动

  - h 左移动

  - l 右移动

  - j 往下移动

  - k 往上移动

  - \# command 跳转#个字数的字符

    ```
    在命令模式中输入： 3j 光标下3行， 5k 表示光标上5行...
    ```

  - 以及键盘上的上下左右键

- ##### 单词间移动

  - 除了下划线都认为是单词的分隔符,分隔符独占一个单词

  - w 下一个单词的词首，分隔符独占一个单词

  - e 当前单词或者下一个单词的词尾

  - b 当前或者前一个单词的词首

  - \#command 跳转#个单词

    ```
    在命令模式中输入：3w 表示后的第3个单词词首 2e 后一个单词词尾或后两个词尾
    ```



- ##### 当前页跳转

  - H 当前页的第一行的行首

  - L 当前页的最后一行行首

  - M 当前页面的中间位置

  - zt 将光标所在的行移动到屏幕的顶端

  - zb 将光标所在的行移动到屏幕的底部

  - zz 将光标所在的行移动到屏幕的中间位置

    

- ##### 行首行尾跳转

  - 0（数字）跳转到行首
  - $ 跳转到行尾
  - ^ 跳转到行首的第一个非空白字符，当有缩进时，使用，跳转至非缩进位置



- ##### 行间移动

  - \#G 扩展命令模式下：#跳转至第#行

  - G 最后一行(shift+G)，跳转到最后行

  - 1G  第一行 （# G)

    ```
    4G 跳转至第四行
    ```

  - gg 回到第一行

  

- ##### 句间移动：(.空格为一句)

  - ):下一句
  - (: 上一句

  

- ##### 段落间移动（空行）

  - } 下一段
  - { 上一段

- ##### 翻屏操作

  - ctrl+f 向文件尾部翻一屏
  - ctrl+b 向文件首部翻一屏
  - ctrl+d 向文件尾部翻半屏
  - ctrl+u 向文件首部翻半屏



#### 命令行的操作

- ##### 字符编辑

  - x 删除光标所在位置，光标后的#个字符（删除光标即以后几个字符）
  - \#x  删除#个字符
  - xp 交换位置（先剪切相应字符，p时粘贴，达到交换的效果）
  - ~大小写转换   
  - J 删除当前行后的换行符（shift+j)

- ##### 替换

  - r 替换：先找到一个字符，按r后修改值（替换光标所在位置）
  - R 切换到替换模式  (里面可以随意替换值)，esc退出

- ##### 删除

  - d 删除，需要结合光标跳转字符

    ```
     1d + 回车 删除一行（默认d + enter）； 1d + 空格 删除后一个字符
     3d + 回车 删除后三行； 3d + 空格 删除后3个字符
    ```

  - d0 删除到行首 

  - d$ 删除到行尾

  - d^ 删除第一个非空字符

  - dw 删除一个单词

  - de 删除当前单词到词尾的位置或者删除下一个单词（主要看当前光标是否在单词内部）

  - db 删除到上一个单词的词首

  - dd 删除当前光标所在行

  - \#dd 删除当前光标行后#行数据

  - dG 删除文件的行尾（文件尾）

  - dgg 删除到文件的行首（文件头）

  - D 相当于 d$ 

- ##### 复制

  - y 复制，需要结合光标跳转字符
  - y$  复制光标位置到行尾
  - y0 复制光标到行首
  - y^  复制光标到行首位置的内容
  - ye  复制光标到词尾
  - yb  复制光标到词首
  - yG  复制光标到文件尾
  - ygg 复制光标到文件首
  - yy 复制整行
  - \#yy 复制几行

- ##### 粘贴

  - p 如果是整行，则粘贴当前行的下面，否则粘贴到光标所在位置的我后面
  - P 如果是整行，则粘贴到当前行所在的上面，否则，则粘贴到光标所在位置的前面



- ##### 改变命令：

  c 修改之后直接切换到插入模式

  - c$  删除光标后的行内容，并进入插入模式

  - c0  删除光标前的行内容，并进入插入模式

  - c^  删除光标前的行内容，并进入插入模式

  - cc  删除当前行并且输入新内容

  - \#cc 删除#行，切换到插入模式

  - C 相当于 c$

  - \#[i|I|a|A|o|O]string esc  粘贴#次string

    ```
    先输入数字，在输入i/a/A/O/o,在输入esc
    ```

- ##### 撤销：

  - u 撤销最近的更改
  - \#u 撤销之前的#号次修改
  - U 撤销光标所在行的关于此行的修改
  - ctrl+r 重做最后的操作，撤销撤销
  - . 重复前一个操作
  - \#. 重复之前的动作多少次

- ##### 查找

  - /pattern 从当前光标所在位置向下查找 (搜索的结果都是一直的，但是n/N方向时不同的)

  - ？pattern 从当前光标所在位置向上查找

  - n 同搜索命令 

  - N 同搜索命令相反

  - /ad..  ; ?mail;...可以使用正则

     

#### 扩展的命令模式

- ##### 地址定界：: start, end

  - \# 具体到多少行

    ```shell
    :2,3d    # 删除第2，3行
    ```

  - m，n  从m开始到n结束

  - m，+n，从m开始，到m+n结束 2， +3 第2行到第5行

    ```shell
    :2,+3d  # 删除第二行到第5行
    ```

  - . 代表当前行

    ```shell
    :.d  # 删除当前行
    :$d   # 删除末行
    ```

  - $ 最后一行

  - $-# 倒数第#+1行

    ```shell
    :$-2d   #删除倒数第二行
    ```

  - % 全部

    ```
    :%d   # 删除全部
    ```

  - /pat1/,/pat2/ 从第一个被pat1匹配到的行开始，一直到第一次被pat2匹配到的行开始

    ```shell
     #, /pat/ 从第几行到匹配到的行   /pat/,$  从匹配到的行到末尾
     
    :1,/alex/d  # 从第一行到第一个alex的行删除
    
    :/alex/,/awa/d   # 删除连个匹配内容中间的行数
    ```

  - 使用方法：后面跟

    - d 删除

    - y 复制

      ```shell
      /alex/,/awa/y  #复制中间内容
      ```

    - w file ：将范围内的文件另存为一个文件

      ```shell
      :/f/,$w passss.txt    # 将所有内容复制输出到文件中
      ```

    - r file 在指定的位置插入文件中的内容

      ```shell
      :2,4r a.txt   # 将a.txt文件中的内容插入到文件的4行后 
      ```

#### 查找替换

##### :地址定位符s/要查找的内容/要替换的内容/装饰器

```shell
:1,$s/awa/AWA/     # 将全文的awa替换为AWA = :%s/awa/AWA/
```

- :s 在扩展模式下完成查找替换操作 

- 格式 :s/要查找的内容/替换为的内容/装饰器

  - 要查找的内容：可以使用正则表达式

    ```shell
    :%s/a.a/AWA/
    ```

  - 要替换的内容：不能使用模式，但可以使用\1,\2等，还可以使用“&”引用前面查找到整个内容

    ```shell
    :%s/\(A.A\)/adf\1/   # 将匹配到的内容（查找部分正则），\1用于取出括号匹配到的内容
    :%s/\(A.A\)/adBf&/   # 效果和上面的一样，只不过用&代替了\1
    ```

  - 修饰符

    - i 忽略大小写

      ```shell
      :%s/ADF/ab/i   # 忽略大小写
      ```

    - g 全局替换 默认情况下，每一行至替换第一个出现的

    - gc 全局替换，每次替换前询问提示

  - 查找替换中的分隔符/可以替换成其他字符

    - @ 或者使用#

      ```shell
      :%s@/@#@     # 将全局的/替换为#
      ```



#### 可视化模式

允许选择的文本块：

- v 面向字符，在命令模式，按小写的v

  ```
  使用光标移动键选中区域，然后使用 y(复制)，d(删除)，p(粘贴)，w(另存为)
  ```

- V 面向行，大写的V，进行选取

- ctrl+v 面向的是块

- 可以配合键盘移动键使用

- 突出显示的文件可以删除，复制，变更，过滤，替换等等



#### 多文件操作

##### vim file1 file2 file3

- :next 下一个
- :prev 前一个
- :first 第一个
- :last 最后一个
- :wall 保存所有
- :qall 退出所有
- :wqall  全部写入和退出

##### 注意：每个文件写完后需保存后才能切换



#### 使用多窗口

- ##### 多文件分割

  - vim -o|-O file1 file2
  - -o 水平分割
  - -O 垂直分割
  - ctrl+w , s 再分隔窗口
  - 切换 ctrl+w

- ##### 单文件分割

  - ctrl-w(松手),s 水平分割
  - ctrl-w,v 垂直分割
  - ctrl-w,q 取消相邻窗口
  - ctrl+w，方向键切换窗口
  - ctrl+w(松手),o 取消全部窗口
  - :wqall

#### 定制vim

- ##### 配置文件：

  - 全局：/etc/vimrc
  - 个人：~/.vimrc  （没有就创建）

- ##### 扩展命令模式：

  - 添加行号 set nu 取消 set nonu
  - 搜索时忽略大小写 set ic  取消set noic
  - 自动缩进（与上一行对其） set ai 取消 set noai
  - 搜索高亮 set hls  取消 set nohls
  - 语法高亮 syntax on 关闭 syntax off
  - 设置光标所在的行的标识符 set cul 取消 set nocul
  - 获取帮助 ：set all
  - 文件格式
    - 转换成windows set fileformat=dos
    - 装换成linux set fileformat=unix
  - vim 内置帮助
    - :help
    - :help topic
    - vimtutor



![vimALL](C:\Users\RootUser\Desktop\知识点复习\Django\gif\vimALL-1564669804796.png)

